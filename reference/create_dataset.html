<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>Create a dataset — create_dataset • NBDCtools</title><script src="../lightswitch.js"></script><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet"><link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet"><script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Create a dataset — create_dataset"><meta name="description" content="This high-level function simplifies the process of creating a dataset from
the ABCD or HBCD Study data by allowing users to create an analysis-ready
dataset in a single step. It executes the lower-level functions provided in
the NBDCtools package in sequence to load, join, and transform the data.
The function expects study data to be stored as one .parquet or .tsv file
per database table within a specified directory, provided as dir_data.
Variables specified in vars and tables will be full-joined together,
while variables specified in vars_add and tables_add will be left-joined
to these variables. For more details, see join_tabulated().
In addition to the main create_dataset() function, there are two
study-specific variations:
create_dataset_abcd(): for the ABCD study.
create_dataset_hbcd(): for the HBCD study.


They have the same arguments as the create_dataset() function, except
that the study argument is set to the respective study by default, and
should not be set by the user."><meta property="og:description" content="This high-level function simplifies the process of creating a dataset from
the ABCD or HBCD Study data by allowing users to create an analysis-ready
dataset in a single step. It executes the lower-level functions provided in
the NBDCtools package in sequence to load, join, and transform the data.
The function expects study data to be stored as one .parquet or .tsv file
per database table within a specified directory, provided as dir_data.
Variables specified in vars and tables will be full-joined together,
while variables specified in vars_add and tables_add will be left-joined
to these variables. For more details, see join_tabulated().
In addition to the main create_dataset() function, there are two
study-specific variations:
create_dataset_abcd(): for the ABCD study.
create_dataset_hbcd(): for the HBCD study.


They have the same arguments as the create_dataset() function, except
that the study argument is set to the respective study by default, and
should not be set by the user."></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top " aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">NBDCtools</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">1.0.0</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="nav-item"><a class="nav-link" href="../articles/NBDCtools.html">Get started</a></li>
<li class="active nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles"><li><a class="dropdown-item" href="../articles/join.html">Join data</a></li>
    <li><a class="dropdown-item" href="../articles/transformation.html">Transform data</a></li>
    <li><a class="dropdown-item" href="../articles/filter.html">Filter data</a></li>
    <li><a class="dropdown-item" href="../articles/metadata.html">Work with metadata</a></li>
    <li><a class="dropdown-item" href="../articles/shadow.html">Work with shadow matrices</a></li>
    <li><a class="dropdown-item" href="../articles/benchmark.html">NBDCtools Benchmark</a></li>
  </ul></li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul><ul class="navbar-nav"><li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json"></form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/nbdc-datahub/NBDCtools/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-lightswitch" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true" aria-label="Light switch"><span class="fa fa-sun"></span></button>
  <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="dropdown-lightswitch"><li><button class="dropdown-item" data-bs-theme-value="light"><span class="fa fa-sun"></span> Light</button></li>
    <li><button class="dropdown-item" data-bs-theme-value="dark"><span class="fa fa-moon"></span> Dark</button></li>
    <li><button class="dropdown-item" data-bs-theme-value="auto"><span class="fa fa-adjust"></span> Auto</button></li>
  </ul></li>
      </ul></div>


  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Create a dataset</h1>
      <small class="dont-index">Source: <a href="https://github.com/nbdc-datahub/NBDCtools/blob/main/R/dataset.R" class="external-link"><code>R/dataset.R</code></a></small>
      <div class="d-none name"><code>create_dataset.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p>This high-level function simplifies the process of creating a dataset from
the ABCD or HBCD Study data by allowing users to create an analysis-ready
dataset in a single step. It executes the lower-level functions provided in
the <code>NBDCtools</code> package in sequence to load, join, and transform the data.</p>
<p>The function expects study data to be stored as one <code>.parquet</code> or <code>.tsv</code> file
per database table within a specified directory, provided as <code>dir_data</code>.
Variables specified in <code>vars</code> and <code>tables</code> will be full-joined together,
while variables specified in <code>vars_add</code> and <code>tables_add</code> will be left-joined
to these variables. For more details, see <code><a href="join_tabulated.html">join_tabulated()</a></code>.</p>
<p>In addition to the main <code>create_dataset()</code> function, there are two
study-specific variations:</p><ul><li><p><code>create_dataset_abcd()</code>: for the ABCD study.</p></li>
<li><p><code>create_dataset_hbcd()</code>: for the HBCD study.</p></li>
</ul><p>They have the same arguments as the <code>create_dataset()</code> function, except
that the <code>study</code> argument is set to the respective study by default, and
should not be set by the user.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">create_dataset</span><span class="op">(</span></span>
<span>  <span class="va">dir_data</span>,</span>
<span>  <span class="va">study</span>,</span>
<span>  vars <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  tables <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  vars_add <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  tables_add <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  release <span class="op">=</span> <span class="st">"latest"</span>,</span>
<span>  format <span class="op">=</span> <span class="st">"parquet"</span>,</span>
<span>  bypass_ram_check <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  categ_to_factor <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  add_labels <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  value_to_label <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  value_to_na <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  time_to_hms <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  bind_shadow <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  <span class="va">...</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="fu">create_dataset_abcd</span><span class="op">(</span><span class="va">...</span><span class="op">)</span></span>
<span></span>
<span><span class="fu">create_dataset_hbcd</span><span class="op">(</span><span class="va">...</span><span class="op">)</span></span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>


<dl><dt id="arg-dir-data">dir_data<a class="anchor" aria-label="anchor" href="#arg-dir-data"></a></dt>
<dd><p>character. Path to the directory with the data files in
<code>.parquet</code> or <code>.tsv</code> format.</p></dd>


<dt id="arg-study">study<a class="anchor" aria-label="anchor" href="#arg-study"></a></dt>
<dd><p>character. NBDC study (One of <code>"abcd"</code> or <code>"hbcd"</code>).</p></dd>


<dt id="arg-vars">vars<a class="anchor" aria-label="anchor" href="#arg-vars"></a></dt>
<dd><p>character (vector). Name(s) of variable(s) to be joined.
(Default: <code>NULL</code>, i.e., no variables are selected; one of <code>tables</code> or
<code>vars</code> has to be provided).</p></dd>


<dt id="arg-tables">tables<a class="anchor" aria-label="anchor" href="#arg-tables"></a></dt>
<dd><p>character (vector). Name(s) of table(s) to be joined (Default:
<code>NULL</code>, i.e., no tables are selected; one of <code>tables</code> or <code>vars</code> has to be
provided).</p></dd>


<dt id="arg-vars-add">vars_add<a class="anchor" aria-label="anchor" href="#arg-vars-add"></a></dt>
<dd><p>character (vector). Name(s) of additional variable(s) to be
left-joined to the variables selected in <code>vars</code> and <code>tables</code> (Default:
<code>NULL</code>, i.e., no additional variables are selected)</p></dd>


<dt id="arg-tables-add">tables_add<a class="anchor" aria-label="anchor" href="#arg-tables-add"></a></dt>
<dd><p>character (vector). Name(s) of additional table(s) to be
left-joined to the variables selected in <code>vars</code> and <code>tables</code> (Default:
<code>NULL</code>, i.e., no additional tables are selected)</p></dd>


<dt id="arg-release">release<a class="anchor" aria-label="anchor" href="#arg-release"></a></dt>
<dd><p>character. Release version (Default: <code>"latest"</code>)</p></dd>


<dt id="arg-format">format<a class="anchor" aria-label="anchor" href="#arg-format"></a></dt>
<dd><p>character. Data format (One of <code>"parquet"</code> or <code>"tsv"</code>; default:
<code>"parquet"</code>).</p></dd>


<dt id="arg-bypass-ram-check">bypass_ram_check<a class="anchor" aria-label="anchor" href="#arg-bypass-ram-check"></a></dt>
<dd><p>logical. If <code>TRUE</code>, the function will not abort
if the number of variables exceeds 10000 and current available RAM is
less than 75% of the estimated RAM usage. This can prevent the long
loading time of the data, but failing in the middle due to insufficient RAM.
For large datasets, it is recommended to save 2 times or more of
estimated RAM before running this function.</p>
<p>This argument is only used for the ABCD study, as the HBCD data
is small enough to be loaded without RAM issues with most personal computers.
As HBCD data grows in the future, this may change.</p></dd>


<dt id="arg-categ-to-factor">categ_to_factor<a class="anchor" aria-label="anchor" href="#arg-categ-to-factor"></a></dt>
<dd><p>logical. Whether to convert categorical
variables to factors class, see <code><a href="transf_factor.html">transf_factor()</a></code> (Default: <code>TRUE</code>).</p></dd>


<dt id="arg-add-labels">add_labels<a class="anchor" aria-label="anchor" href="#arg-add-labels"></a></dt>
<dd><p>logical. Whether to adds variable and value labels to the
variables, see <code><a href="transf_label.html">transf_label()</a></code> (Default: <code>TRUE</code>).</p></dd>


<dt id="arg-value-to-label">value_to_label<a class="anchor" aria-label="anchor" href="#arg-value-to-label"></a></dt>
<dd><p>logical. Whether to convert the categorical
variables' numeric values to labels, see <code><a href="transf_value_to_label.html">transf_value_to_label()</a></code>
(Default: <code>FALSE</code>). To run this process, <code>categ_to_factor</code> and <code>add_labels</code>
must be <code>TRUE</code>.</p></dd>


<dt id="arg-value-to-na">value_to_na<a class="anchor" aria-label="anchor" href="#arg-value-to-na"></a></dt>
<dd><p>logical. Whether to convert categorical
missingness/non-response codes to <code>NA</code>, see <code><a href="transf_value_to_na.html">transf_value_to_na()</a></code>
(Default: <code>FALSE</code>). To run this process, <code>categ_to_factor</code> and <code>add_labels</code>
must be <code>TRUE</code>.</p></dd>


<dt id="arg-time-to-hms">time_to_hms<a class="anchor" aria-label="anchor" href="#arg-time-to-hms"></a></dt>
<dd><p>logical. Whether to convert time variables to
<code>hms</code> class, see <code><a href="transf_time_to_hms.html">transf_time_to_hms()</a></code> (Default: <code>FALSE</code>).</p></dd>


<dt id="arg-bind-shadow">bind_shadow<a class="anchor" aria-label="anchor" href="#arg-bind-shadow"></a></dt>
<dd><p>logical. Whether to bind the shadow matrix to the
dataset (Default: <code>FALSE</code>). See more in details.</p></dd>


<dt id="arg--">...<a class="anchor" aria-label="anchor" href="#arg--"></a></dt>
<dd><p>additional arguments passed to downstream functions after
the <code><a href="join_tabulated.html">join_tabulated()</a></code> step. See examples for details.</p></dd>

</dl></div>
    <div class="section level2">
    <h2 id="value">Value<a class="anchor" aria-label="anchor" href="#value"></a></h2>
    <p>A tibble with the analysis-ready dataset.</p>
    </div>
    <div class="section level2">
    <h2 id="details">Details<a class="anchor" aria-label="anchor" href="#details"></a></h2>

<div class="section">
<h3 id="order">Order<a class="anchor" aria-label="anchor" href="#order"></a></h3>


<p>This high-level function executes the different steps in the following order:</p><ol><li><p>Read the data/shadow matrix using <code><a href="join_tabulated.html">join_tabulated()</a></code>.</p></li>
<li><p>Convert categorical variables to factors using <code><a href="transf_factor.html">transf_factor()</a></code>.</p></li>
<li><p>Add labels to the variables and values using <code><a href="transf_label.html">transf_label()</a></code>.</p></li>
<li><p>Convert categorical variables' numeric values to labels using
<code><a href="transf_value_to_label.html">transf_value_to_label()</a></code>.</p></li>
<li><p>Convert categorical missingness/non-response codes to <code>NA</code> using
<code><a href="transf_value_to_na.html">transf_value_to_na()</a></code>.</p></li>
<li><p>Convert time variables to <code>hms</code> class using <code><a href="transf_time_to_hms.html">transf_time_to_hms()</a></code>.</p></li>
<li><p>If <code>bind_shadow</code> and the study is <code>"HBCD"</code>, replace the missing values
in the shadow due to joining multiple
datasets using <code><a href="shadow_replace_binding_missing.html">shadow_replace_binding_missing()</a></code>.</p></li>
<li><p>Bind the shadow matrix to the data using <code><a href="shadow_bind_data.html">shadow_bind_data()</a></code>.</p></li>
</ol><p>Not all steps are executed by default. The above order represents the maximal
order of execution.</p>
</div>

<div class="section">
<h3 id="bind-shadow"><code>bind_shadow</code><a class="anchor" aria-label="anchor" href="#bind-shadow"></a></h3>


<p>If <code>bind_shadow</code> is <code>TRUE</code>, the shadow matrix will be added to the data using
<code><a href="shadow_bind_data.html">shadow_bind_data()</a></code>.</p><ul><li><p><strong>HBCD study:</strong> For the <code>HBCD</code> study, this function uses the shadow matrix
from the <code>dir_data</code> directory by default (the HBCD Study releases a
<code>_shadow.parquet</code>/<code>_shadow.tsv</code> file per table that accompanies the data).
Alternatively, one can set <code>naniar_shadow = TRUE</code> as part of the <code>...</code>
arguments to use <code><a href="https://naniar.njtierney.com/reference/as_shadow.html" class="external-link">naniar::as_shadow()</a></code> to create a shadow matrix from the
data.</p></li>
<li><p><strong>ABCD study:</strong> The <code>ABCD</code> Study does not currently release shadow
matrices. If <code>bind_shadow</code> is set to <code>TRUE</code>, the function will create the
shadow matrix from the data using <code><a href="https://naniar.njtierney.com/reference/as_shadow.html" class="external-link">naniar::as_shadow()</a></code>; no extra
<code>naniar_shadow = TRUE</code> argument is needed.</p></li>
</ul></div>

    </div>

    <div class="section level2">
    <h2 id="ref-examples">Examples<a class="anchor" aria-label="anchor" href="#ref-examples"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span><span class="kw">if</span> <span class="op">(</span><span class="cn">FALSE</span><span class="op">)</span> <span class="op">{</span> <span class="co"># \dontrun{</span></span></span>
<span class="r-in"><span><span class="co"># most common use case</span></span></span>
<span class="r-in"><span><span class="fu">create_dataset</span><span class="op">(</span></span></span>
<span class="r-in"><span>  dir_data <span class="op">=</span> <span class="st">"6_0/data"</span>,</span></span>
<span class="r-in"><span>  study <span class="op">=</span> <span class="st">"abcd"</span>,</span></span>
<span class="r-in"><span>  vars <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"var1"</span>, <span class="st">"var2"</span>, <span class="st">"var3"</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># to handle with tagged missingness</span></span></span>
<span class="r-in"><span><span class="fu">create_dataset</span><span class="op">(</span></span></span>
<span class="r-in"><span>  dir_data <span class="op">=</span> <span class="st">"1_0/data"</span>,</span></span>
<span class="r-in"><span>  study <span class="op">=</span> <span class="st">"hbcd"</span>,</span></span>
<span class="r-in"><span>  vars <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"var1"</span>, <span class="st">"var2"</span>, <span class="st">"var3"</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>  value_to_na <span class="op">=</span> <span class="cn">TRUE</span></span></span>
<span class="r-in"><span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># to bind shadow matrices to the data</span></span></span>
<span class="r-in"><span><span class="fu">create_dataset</span><span class="op">(</span></span></span>
<span class="r-in"><span>  dir_data <span class="op">=</span> <span class="st">"1_0/data/"</span>,</span></span>
<span class="r-in"><span>  study <span class="op">=</span> <span class="st">"hbcd"</span>,</span></span>
<span class="r-in"><span>  vars <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"var1"</span>, <span class="st">"var2"</span>, <span class="st">"var3"</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>  bind_shadow <span class="op">=</span> <span class="cn">TRUE</span></span></span>
<span class="r-in"><span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># to use the additional arguments</span></span></span>
<span class="r-in"><span><span class="co"># for example in `value_to_na` option, the underlying function</span></span></span>
<span class="r-in"><span><span class="co"># `transf_value_to_na()` has 2 more arguments,</span></span></span>
<span class="r-in"><span><span class="co"># which can be passed to the `create_dataset()` function</span></span></span>
<span class="r-in"><span><span class="fu">create_dataset</span><span class="op">(</span></span></span>
<span class="r-in"><span>  dir_data <span class="op">=</span> <span class="st">"6_0/data"</span>,</span></span>
<span class="r-in"><span>  study <span class="op">=</span> <span class="st">"abcd"</span>,</span></span>
<span class="r-in"><span>  vars <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"var1"</span>, <span class="st">"var2"</span>, <span class="st">"var3"</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>  value_to_na <span class="op">=</span> <span class="cn">TRUE</span>,</span></span>
<span class="r-in"><span>  missing_codes <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"999"</span>, <span class="st">"888"</span>, <span class="st">"777"</span>, <span class="st">"666"</span>, <span class="st">"555"</span>, <span class="st">"444"</span>, <span class="st">"333"</span>, <span class="st">"222"</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>  ignore_col_pattern <span class="op">=</span> <span class="st">"__dk$|__dk__l$"</span></span></span>
<span class="r-in"><span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># use study specific functions</span></span></span>
<span class="r-in"><span><span class="fu">create_dataset_abcd</span><span class="op">(</span></span></span>
<span class="r-in"><span>  dir_data <span class="op">=</span> <span class="st">"6_0/data"</span>,</span></span>
<span class="r-in"><span>  vars <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"var1"</span>, <span class="st">"var2"</span>, <span class="st">"var3"</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="op">}</span> <span class="co"># }</span></span></span>
</code></pre></div>
    </div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p>Developed by Janosch Linkersdoerfer, Le Zhang.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.3.</p>
</div>

    </footer></div>





  </body></html>

