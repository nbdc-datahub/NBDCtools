<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>NBDCtools Benchmark • NBDCtools</title>
<script src="../lightswitch.js"></script><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="NBDCtools Benchmark">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top " aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">NBDCtools</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">1.0.1</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../articles/NBDCtools.html">Get started</a></li>
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="../articles/join.html">Join data</a></li>
    <li><a class="dropdown-item" href="../articles/transformation.html">Transform data</a></li>
    <li><a class="dropdown-item" href="../articles/filter.html">Filter data</a></li>
    <li><a class="dropdown-item" href="../articles/metadata.html">Work with metadata</a></li>
    <li><a class="dropdown-item" href="../articles/shadow.html">Work with shadow matrices</a></li>
    <li><a class="dropdown-item" href="../articles/benchmark.html">NBDCtools Benchmark</a></li>
  </ul>
</li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/nbdc-datahub/NBDCtools/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-lightswitch" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true" aria-label="Light switch"><span class="fa fa-sun"></span></button>
  <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="dropdown-lightswitch">
<li><button class="dropdown-item" data-bs-theme-value="light"><span class="fa fa-sun"></span> Light</button></li>
    <li><button class="dropdown-item" data-bs-theme-value="dark"><span class="fa fa-moon"></span> Dark</button></li>
    <li><button class="dropdown-item" data-bs-theme-value="auto"><span class="fa fa-adjust"></span> Auto</button></li>
  </ul>
</li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>NBDCtools Benchmark</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/nbdc-datahub/NBDCtools/blob/main/vignettes/articles/benchmark.Rmd" class="external-link"><code>vignettes/articles/benchmark.Rmd</code></a></small>
      <div class="d-none name"><code>benchmark.Rmd</code></div>
    </div>

    
    
<p>In this vignette, we discuss the data loading and processing
performance of the <code>NBDCtools</code> package. We will analyze the
time and memory required for loading data from parquet files and for
preparing them in a ready-to-use format using the
<code><a href="../reference/join_tabulated.html">join_tabulated()</a></code> function.</p>
<p>To illustrate the variability of results, we performed <strong>3
replications</strong> of each benchmark statistic reported below, using
a server with following specifications:</p>
<ul>
<li>
<strong>CPU:</strong> Intel(R) Xeon(R) Gold 6448H (256) @ 4.10
GHz</li>
<li>
<strong>RAM:</strong> 4TB of DDR5 4400MT/s PC5-38400R 4800MHz</li>
<li>
<strong>OS:</strong> Rocky Linux 8.10 x86_64</li>
<li>
<strong>IO:</strong> Data are saved on a network mounted drive with
read speed about ~350 MB/s and write speed about ~300 MB/s.</li>
</ul>
<p>Newer hardware will likely yield better performance, especially with
better CPUs, SSDs, and better RAM speed. The results here only present a
baseline for the performance. Among these, the most important factor is
the <strong>IO speed and CPU speed</strong> as they will significantly
improve the performance of the package.</p>
<p>We hope this information will help you decide how many variables you
can load with a reasonable time and memory usage when creating datasets
using <code><a href="../reference/join_tabulated.html">join_tabulated()</a></code> (or the higher-level wrapper
function <code><a href="../reference/create_dataset.html">create_dataset()</a></code>). You can use our utility
function <code>estimate_loading()</code> to estimate the needed time and
memory usage for loading a specific number of variables.</p>
<blockquote>
<p><strong>IMPORTANT Notes:</strong></p>
<ul>
<li><p>This estimate has better accuracy for randomly selected variables
than randomly selected tables. For example, using
<code>join_tabulated(tables = ...)</code> or
<code>create_dataset(tables = ...)</code>, will significantly decrease
the time and memory needed in datasets with fewer variables. Please
treat the statistics as a worst-case baseline.</p></li>
<li><p>Remember that this benchmark is based on a server with only IO
speed of ~350 MB/s. Modern personal computers typically have SSDs with
much better speed, like 7000 MB/s or even faster, so the actual time it
takes to load a data frame can be significantly shorter.</p></li>
<li><p>The benchmarks are derived based on data from the <strong>ABCD
6.0</strong> release. The performance will vary with different data
releases as the number of rows (participants/events) is increasing with
each release. The estimates should <strong>not be used the HBCD
data</strong>, as the number of participant/events is significantly
smaller than in the ABCD data. Loading the whole HBCD data would not
take much time or memory. Benchmarks may be added in the future for HBCD
data as it grows.</p></li>
</ul>
</blockquote>
<div class="section level2">
<h2 id="loading-data">Loading data<a class="anchor" aria-label="anchor" href="#loading-data"></a>
</h2>
<div class="section level3">
<h3 id="loading-time">Loading time<a class="anchor" aria-label="anchor" href="#loading-time"></a>
</h3>
<div class="section level4">
<h4 id="randomly-selected-tables">Randomly selected tables<a class="anchor" aria-label="anchor" href="#randomly-selected-tables"></a>
</h4>
<p>In a first benchmarking scenario, we randomly selected between 20 and
700 tables from the ABCD data dictionary and loaded and joined all
variables from these tables using the <code><a href="../reference/join_tabulated.html">join_tabulated()</a></code>
function. This scenario represents a common use case where researchers
have a specific domain of interest and want to load all variables from a
few selected tables within that domain.</p>
<p>Because the number of variables varies between tables, the plot below
displays the results by the number of variables.</p>
<p><img src="benchmark_files/figure-html/unnamed-chunk-3-1.png" width="768"></p>
</div>
<div class="section level4">
<h4 id="randomly-selected-variables">Randomly selected variables<a class="anchor" aria-label="anchor" href="#randomly-selected-variables"></a>
</h4>
<p>In a second benchmarking scenario, we used the
<code><a href="../reference/join_tabulated.html">join_tabulated()</a></code> function to join randomly selected
variables from the ABCD data dictionary, independent of the tables they
belong to. This represents a “worst case” scenario, as the function has
to load and join variables from a larger number of tables.</p>
<div class="section level5">
<h5 id="under-1000-variables">Under 1000 variables<a class="anchor" aria-label="anchor" href="#under-1000-variables"></a>
</h5>
<p>This plot includes only cases with under 1000 variables which
represents a more common use case, as typically the analyses are done on
a small subset of variables.</p>
<p><img src="benchmark_files/figure-html/unnamed-chunk-4-1.png" width="768"></p>
</div>
<div class="section level5">
<h5 id="all-ranges">All ranges<a class="anchor" aria-label="anchor" href="#all-ranges"></a>
</h5>
<p>This plot includes all cases, with datasets ranging from a few
hundred to 80k variables.</p>
<p><img src="benchmark_files/figure-html/unnamed-chunk-5-1.png" width="768"></p>
</div>
</div>
<div class="section level4">
<h4 id="comparison-of-random-variables-vs--random-tables">Comparison of random variables vs. random tables<a class="anchor" aria-label="anchor" href="#comparison-of-random-variables-vs--random-tables"></a>
</h4>
<p>In the following plot, we compare the time taken to load random
variables vs. random tables. As expected, loading random variables takes
significantly more time than loading random tables.</p>
<p><img src="benchmark_files/figure-html/unnamed-chunk-6-1.png" width="768"></p>
</div>
</div>
<div class="section level3">
<h3 id="memory-usage">Memory usage<a class="anchor" aria-label="anchor" href="#memory-usage"></a>
</h3>
<p>Memory usage is stable across different runs or across different
machines. The following plot compares memory usage, measured in GB, when
joining random tables vs. random variables. Joining random variables
requires more memory than random tables. This is because joining random
variables typically requires to load more tables than joining random
tables does and R’s garbage collection is imperfect so that some memory
is not released immediately after the data is joined. However, the
memory difference is not significant, and the memory usage is stable
across different runs. Therefore, the following statistics can be used
as gold standard for memory requirements when loading and joining data
using <code>NBDCtools</code>.</p>
<p><img src="benchmark_files/figure-html/unnamed-chunk-7-1.png" width="768"></p>
</div>
</div>
<div class="section level2">
<h2 id="processing-data">Processing data<a class="anchor" aria-label="anchor" href="#processing-data"></a>
</h2>
<p>To create analysis-ready data, all columns should be converted to the
correct type, i.e., categorical columns should be converted to R
factors. This is achieved using the <code><a href="../reference/transf_factor.html">transf_factor()</a></code>
function in <code>NBDCtools</code>. Here we provide the time and memory
usage for this function.</p>
<p>After the dataset is loaded into memory, the downstream processing
speed and memory usage are independent of whether the dataset was
created by joining randomly selected variables or randomly selected
tables. As such, we do not group by this characteristic in the following
plot.</p>
<div class="section level3">
<h3 id="time">Time<a class="anchor" aria-label="anchor" href="#time"></a>
</h3>
<p><img src="benchmark_files/figure-html/unnamed-chunk-8-1.png" width="768"></p>
</div>
<div class="section level3">
<h3 id="memory-usage-1">Memory usage<a class="anchor" aria-label="anchor" href="#memory-usage-1"></a>
</h3>
<p>The following plot presents the object size difference after the data
has been loaded and has been processed with <code><a href="../reference/transf_factor.html">transf_factor()</a></code>
as a consecutive step.</p>
<p><img src="benchmark_files/figure-html/unnamed-chunk-9-1.png" width="768"></p>
<blockquote>
<p><strong>IMPORTANT NOTE:</strong> The plot displays the memory needed
to represent the <em>resulting object</em>. For example, based on the
plot we see that loading 10,000 variables requires about 15.8 GB of
memory, and processing it with <code><a href="../reference/transf_factor.html">transf_factor()</a></code> requires
about 17.6 GB of memory. However, that does not mean that the
<em>maximum memory needed while creating that object</em> is 17.6 GB.
There are a few instances where the input data is copied during
processing, sometimes not only once but multiple times, so the maximum
memory usage during processing can be much higher than the final memory
usage. We recommend to plan to have <strong>2-3x</strong> more memory
than is used by the final data frame available on your machine to avoid
memory issues during processing.</p>
</blockquote>
</div>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Janosch Linkersdoerfer, Le Zhang.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.3.</p>
</div>

    </footer>
</div>





  </body>
</html>
