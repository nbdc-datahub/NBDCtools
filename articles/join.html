<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Join data • NBDCtools</title>
<script src="../lightswitch.js"></script><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Join data">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top " aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">NBDCtools</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">1.0.1</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../articles/NBDCtools.html">Get started</a></li>
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="../articles/join.html">Join data</a></li>
    <li><a class="dropdown-item" href="../articles/transformation.html">Transform data</a></li>
    <li><a class="dropdown-item" href="../articles/filter.html">Filter data</a></li>
    <li><a class="dropdown-item" href="../articles/metadata.html">Work with metadata</a></li>
    <li><a class="dropdown-item" href="../articles/shadow.html">Work with shadow matrices</a></li>
    <li><a class="dropdown-item" href="../articles/benchmark.html">NBDCtools Benchmark</a></li>
  </ul>
</li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/nbdc-datahub/NBDCtools/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-lightswitch" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true" aria-label="Light switch"><span class="fa fa-sun"></span></button>
  <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="dropdown-lightswitch">
<li><button class="dropdown-item" data-bs-theme-value="light"><span class="fa fa-sun"></span> Light</button></li>
    <li><button class="dropdown-item" data-bs-theme-value="dark"><span class="fa fa-moon"></span> Dark</button></li>
    <li><button class="dropdown-item" data-bs-theme-value="auto"><span class="fa fa-adjust"></span> Auto</button></li>
  </ul>
</li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Join data</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/nbdc-datahub/NBDCtools/blob/main/vignettes/articles/join.Rmd" class="external-link"><code>vignettes/articles/join.Rmd</code></a></small>
      <div class="d-none name"><code>join.Rmd</code></div>
    </div>

    
    
<p>In this vignette, we will demonstrate how to load/join selected
variables and/or tables from data files downloaded from the NBDC Data
Hub into a single data frame in memory.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://software.nbdc-datahub.org/NBDCtools/">NBDCtools</a></span><span class="op">)</span></span>
<span><span class="co">#&gt; Welcome to the `NBDCtools` package! For more information, visit: https://software.nbdc-datahub.org/NBDCtools/</span></span>
<span><span class="co">#&gt; This package is developed by the ABCD Data Analysis, Informatics &amp; Resource Center (DAIRC) at the J. Craig Venter Institute (JCVI)</span></span></code></pre></div>
<p>To download data from the ABCD or HBCD studies through the NBDC Data
Hub, users need to have a valid Data Use Certification (DUC) (see <a href="https://www.nbdc-datahub.org/data-access-process" class="external-link">here</a> for
more details). In this documentation, we will use simulated ABCD data
files to demonstrate the package’s functionality.</p>
<p>You can use the following command to inspect the simulated data
files:</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">dir_abcd</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span><span class="st">"extdata"</span>, <span class="st">"phenotype"</span>, package <span class="op">=</span> <span class="st">"NBDCtools"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/list.files.html" class="external-link">list.files</a></span><span class="op">(</span><span class="va">dir_abcd</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "ab_g_dyn.parquet"           "ab_g_stc.parquet"          </span></span>
<span><span class="co">#&gt; [3] "mr_y_qc__raw__dmri.parquet"</span></span></code></pre></div>
<p>We can see that the <code>phenotype/</code> directory contains
several files. Each file contains the data from a database table in the
ABCD study. For example, the <code>ab_g_dyn.parquet</code> file contains
variables from the <a href="https://abcd.deapscience.com/?hierarchyOrder=%5B%22study%22%2C%22domain%22%2C%22subDomain%22%2C%22source%22%2C%22metric%22%2C%22atlas%22%5D&amp;hierarchy=%5B%5B%22General%22%2C%22ABCD%20Dynamic%20Variables%20%5BGeneral%5D%22%5D%5D#/my-datasets/create-dataset" class="external-link">ABCD
Dynamic Variables [General]</a> table.</p>
<p>In a more realistic scenario, once you downloaded the ABCD data files
to a local directory, there will be a lot more files in the
<code>phenotype/</code> directory; it should contain one file per
database table for a given study. To see the tables available in the
ABCD tabulated data resource, you can use <code>NBDCtools</code>’
<code><a href="../reference/get_dd.html">get_dd_abcd()</a></code> function:</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">dd_abcd</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/get_dd.html">get_dd_abcd</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="va">dd_abcd</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/distinct.html" class="external-link">distinct</a></span><span class="op">(</span><span class="va">table_name</span>, <span class="va">table_label</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 718 × 2</span></span></span>
<span><span class="co">#&gt;    table_name  table_label                                 </span></span>
<span><span class="co">#&gt;    <span style="color: #949494; font-style: italic;">&lt;glue&gt;</span>      <span style="color: #949494; font-style: italic;">&lt;glue&gt;</span>                                      </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 1</span> ab_g_dyn    ABCD Dynamic Variables [General]            </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 2</span> ab_g_stc    ABCD Static Variables [General]             </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 3</span> ab_p_demo   Demographics [Parent]                       </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 4</span> ab_p_ocp    Occupation Survey [Parent]                  </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 5</span> ab_p_screen Screener (Study Eligibility) [Parent]       </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 6</span> fc_p_aclt   Acculturation [Parent]                      </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 7</span> fc_p_drv    Youth Driving [Parent]                      </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 8</span> fc_p_fes    Family Environment Scale [Parent]           </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 9</span> fc_p_hsf    Home Short Form [Parent]                    </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">10</span> fc_p_meim   Multi-Group Ethnic Identity Measure [Parent]</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># ℹ 708 more rows</span></span></span></code></pre></div>
<div class="section level2">
<h2 id="join-data">Join data<a class="anchor" aria-label="anchor" href="#join-data"></a>
</h2>
<p>We can use the <code><a href="../reference/join_tabulated.html">join_tabulated()</a></code> function to load the
data from the files in the <code>phenotype/</code> directory. The
function will read and join the data from different tables based on the
variables and/or tables specified in the these four arguments:</p>
<ul>
<li>
<code>vars</code>: individual variables of interest</li>
<li>
<code>tables</code>: full tables of interest</li>
<li>
<code>vars_add</code>: additional individual variables</li>
<li>
<code>tables_add</code>: additional full tables</li>
</ul>
<p>The <code>vars</code> and <code>tables</code> arguments are used to
specify the main variables and/or tables of interest. They will be
extracted from the respective files on disk and will be joined by the
identifier columns into a single data frame in memory. The used join
operation is a <code>full_join()</code>, i.e., the resulting data frame
retains all rows that have at least one non-missing value in the chosen
variables/tables.</p>
<p>The <code>vars_add</code> and <code>tables_add</code> arguments are
used to specify additional variables and/or tables to be joined with the
main variables/tables of interest. The used join operation for adding
these variables is a <code>left_join()</code>, i.e., only values for
already existing rows will be added and no new rows will be created.
This is useful for adding variables to the dataset that are important
for a given analysis but are not the main variables of interest (e.g.,
design/nesting or demographic information). By left-joining these
variables, one avoids creating new rows that contain only missing values
for the main variables of interest selected using <code>vars</code> and
<code>tables</code>.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/join_tabulated.html">join_tabulated</a></span><span class="op">(</span></span>
<span>  dir_data <span class="op">=</span> <span class="va">dir_abcd</span>,</span>
<span>  study <span class="op">=</span> <span class="st">"abcd"</span>,</span>
<span>  vars <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span></span>
<span>    <span class="st">"mr_y_qc__raw__dmri__r01__series_t"</span>,</span>
<span>    <span class="st">"ab_g_dyn__visit_type"</span>,</span>
<span>    <span class="st">"ab_g_dyn__cohort_grade"</span>, </span>
<span>    <span class="st">"ab_g_dyn__visit__day1_dt"</span>,</span>
<span>    <span class="st">"ab_g_stc__gen_pc__01"</span>, </span>
<span>    <span class="st">"ab_g_dyn__visit_age"</span>,</span>
<span>    <span class="st">"ab_g_dyn__visit_days"</span>, </span>
<span>    <span class="st">"ab_g_dyn__visit_dtt"</span></span>
<span>  <span class="op">)</span></span>
<span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">ℹ</span> Joining 8 variables from 3 tables...</span></span>
<span><span class="co">#&gt; <span style="color: #00BB00;">✔</span> Joining 8 variables from 3 tables... <span style="color: #B2B2B2;">[141ms]</span></span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 10 × 10</span></span></span>
<span><span class="co">#&gt;    participant_id session_id mr_y_qc__raw__dmri__r01__ser…¹ ab_g_dyn__visit_type</span></span>
<span><span class="co">#&gt;    <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>          <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>      <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>                          <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>               </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 1</span> sub-0000000001 ses-02A    <span style="color: #BB0000;">NA</span>                             1                   </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 2</span> sub-0000000002 ses-03A    16:45:46                       1                   </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 3</span> sub-0000000003 ses-01A    11:05:35                       1                   </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 4</span> sub-0000000004 ses-04A    11:05:35                       2                   </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 5</span> sub-0000000005 ses-01A    16:45:46                       2                   </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 6</span> sub-0000000006 ses-04A    <span style="color: #BB0000;">NA</span>                             3                   </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 7</span> sub-0000000007 ses-05A    <span style="color: #BB0000;">NA</span>                             1                   </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 8</span> sub-0000000008 ses-03A    10:14:34                       3                   </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 9</span> sub-0000000009 ses-00S    15:47:35                       3                   </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">10</span> sub-0000000010 ses-04A    15:47:35                       3                   </span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># ℹ abbreviated name: ¹​mr_y_qc__raw__dmri__r01__series_t</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># ℹ 6 more variables: ab_g_dyn__cohort_grade &lt;chr&gt;,</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;">#   ab_g_dyn__visit__day1_dt &lt;date&gt;, ab_g_stc__gen_pc__01 &lt;dbl&gt;,</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;">#   ab_g_dyn__visit_age &lt;dbl&gt;, ab_g_dyn__visit_days &lt;int&gt;,</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;">#   ab_g_dyn__visit_dtt &lt;dttm&gt;</span></span></span></code></pre></div>
<blockquote>
<p><strong>NOTE:</strong> This is a simulated dataset, so the number of
rows are significantly smaller than the real data.</p>
</blockquote>
<p><strong><em><code>remove_empty_rows</code> argument</em></strong></p>
<p>Joining selected columns from different tables using
<code><a href="../reference/join_tabulated.html">join_tabulated()</a></code> may result in rows with only missing
values. This can occur when some participant/events lack data for the
selected variables but have data for other, unselected variables in the
joined tables. Since rows without any data are not useful for analysis,
the <code><a href="../reference/join_tabulated.html">join_tabulated()</a></code> function includes the
<code>remove_empty_rows</code> argument to eliminate these rows from the
resulting dataset. By default, this argument is set to
<code>TRUE</code>, meaning rows with all missing data will be removed.
To keep these rows, set the argument to <code>FALSE</code>.</p>
<div class="section level3">
<h3 id="shadow-matrices">Shadow matrices<a class="anchor" aria-label="anchor" href="#shadow-matrices"></a>
</h3>
<p>For HBCD data, the <code><a href="../reference/join_tabulated.html">join_tabulated()</a></code> function can also
join shadow matrices, which store the reasons for missing values. Shadow
matrix files are located in the same directory as the data files, with
one <code>{table_name}_shadow.parquet</code> file accompanying each
<code>{table_name}.parquet</code> file. To load the shadow matrices, use
the <code>shadow = TRUE</code> argument in the
<code><a href="../reference/join_tabulated.html">join_tabulated()</a></code> function. This will load selected columns
or tables from the shadow matrix files and combine them into a single
table, just like the main data. For more information about shadow
matrices, see the <a href="shadow.html">Work with shadow matrices</a>
vignette.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/join_tabulated.html">join_tabulated</a></span><span class="op">(</span></span>
<span>  dir_data <span class="op">=</span> <span class="va">dir_abcd</span>,</span>
<span>  study <span class="op">=</span> <span class="st">"hbcd"</span>,</span>
<span>  vars <span class="op">=</span> <span class="va">...</span>,</span>
<span>  tables <span class="op">=</span> <span class="va">...</span>,</span>
<span>  <span class="va">...</span>,</span>
<span>  shadow <span class="op">=</span> <span class="cn">TRUE</span></span>
<span><span class="op">)</span></span></code></pre></div>
</div>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Janosch Linkersdoerfer, Le Zhang.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.3.</p>
</div>

    </footer>
</div>





  </body>
</html>
